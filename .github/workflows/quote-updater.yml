name: âš¡ Update Daily Quote

on:
  schedule:
    - cron: "0 0 * * *" # Run daily at midnight UTC
  workflow_dispatch:

jobs:
  update-readme:
    runs-on: ubuntu-latest

    steps:
    - name: â¬‡ï¸ Checkout Repo
      uses: actions/checkout@v3

    # Fallback quotes in case API fails
    - name: ğŸ“œ Setup Fallback Quotes
      run: |
        cat <<EOF > fallback_quotes.txt
Believe in yourself and all that you are. â€” Christian D. Larson
Success is not final, failure is not fatal: It is the courage to continue that counts. â€” Winston Churchill
Your time is limited, so don't waste it living someone else's life. â€” Steve Jobs
Hardships often prepare ordinary people for an extraordinary destiny. â€” C.S. Lewis
EOF

    # Try fetching quote from API. If it fails, use a fallback
    - name: ğŸ§  Fetch Motivational Quote
      id: getquote
      run: |
        set -e

        mkdir -p .github/data

        echo "Trying to fetch quote from API..."
        if curl -s https://api.quotable.io/random > quote.json; then
          content=$(jq -r '.content' quote.json)
          author=$(jq -r '.author' quote.json)
          quote="ğŸ“Œ $content â€” $author"
        else
          echo "API failed. Picking random fallback quote..."
          quote="ğŸ“Œ $(shuf -n 1 fallback_quotes.txt)"
        fi

        # Cache file for past quotes
        touch .github/data/.quotes_history.txt

        # Avoid repeating recent quotes
        if grep -Fxq "$quote" .github/data/.quotes_history.txt; then
          echo "Quote already used. Selecting another..."
          quote="ğŸ“Œ $(shuf -n 1 fallback_quotes.txt)"
        fi

        echo "$quote" >> .github/data/.quotes_history.txt
        echo "QUOTE=$quote" >> $GITHUB_ENV

    - name: ğŸ“ Update README with New Quote
      run: |
        new_quote="### ğŸ”¥ Random Motivation Quote\n> \"$QUOTE\"\n\n---"

        awk -v r="$new_quote" '
          BEGIN {found=0}
          /### ğŸ”¥ Random Motivation Quote/ {found=1; print r; next}
          /---/ && found {found=0; next}
          !found {print}
        ' README.md > temp.md && mv temp.md README.md

    - name: ğŸš€ Commit and Push Changes
      run: |
        git config user.name "github-actions"
        git config user.email "github-actions@github.com"
        git add README.md .github/data/.quotes_history.txt
        git commit -m "âœ¨ Daily motivational quote update"
        git push
